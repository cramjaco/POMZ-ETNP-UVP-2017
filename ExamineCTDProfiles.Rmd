---
title: "R Notebook"
output: html_notebook
---
# CTD Data for comparason

```{r}
source("bring_in_ctd.R")
```

```{r}
library(tidyverse)
library(plotly)
```


```{r}
ctdP2 <- ctd.m %>% left_join(cast2 %>% select(pstation, cast), by = 'cast') %>% filter(pstation == 'P2')
# bin by 10 m
depthBins <- seq(from = 0, to = max(ctdP2$depth), by = 10)
depthMids <- seq(from = 5, to = max(ctdP2$depth), by = 10)
ctdP2$depthBin <- cut(ctdP2$depth, breaks = depthBins, labels = depthMids) %>% as.character %>% as.numeric
ctdP2Binned <- ctdP2 %>% filter(is.finite(depthBin)) %>% group_by(cast, variable, depthBin) %>% summarise(value = mean(value)) #%>% group_by(variable, depthBin) %>% summarize(value = mean(value))
```

Variability in fluorescence
```{r}
ctdP2Binned %>% filter(variable == "fluorescence") %>%
  ggplot(aes(y = depthBin, x = value, colour = as.ordered(cast))) +
  geom_path() + scale_y_reverse(limits = c(400, 0))
```

Mean Fluorescence
```{r}
fluprof <- ctdP2Binned %>% filter(variable == "fluorescence") %>%
  group_by(depthBin) %>% summarize(value = mean(value)) %>%
  ggplot(aes(y = depthBin, x = value)) +
  geom_path() + scale_y_reverse()
fluprof + scale_y_reverse(limits = c(400, 0))
```

Variability in Oxygen
```{r}
ctdP2Binned %>% filter(variable == "oxygen") %>%
  ggplot(aes(y = depthBin, x = value, colour = as.ordered(cast))) +
  geom_path() + scale_y_reverse()
```

Oxygen

```{r}
oxyprof <- ctdP2Binned %>% filter(variable == "oxygen") %>%
  group_by(depthBin) %>% summarize(value = mean(value)) %>%
  ggplot(aes(y = depthBin, x = value)) +
  geom_path() + scale_y_reverse()
oxyprof
```

# Combined profiles
,
             labeller = as_labeller(salinity = "temperature (C)")

```{r}
ctdP2Binned %>% rename(depth = depthBin) %>% filter(depth <= 1500, cast == 43) %>% ungroup() %>%
  mutate(variable = fct_relevel(variable, levels = c("temperature", "salinity", "sigmaT", "fluorescence", "oxygen", "beamAttenuation"))) %>%
  ggplot(aes(x = value, y = depth)) +
  facet_wrap(~variable, scales = "free", strip.position = "bottom") +
  scale_y_reverse() + geom_path()
```

```{r}
ctdP2Binned %>% rename(depth = depthBin) %>% filter(depth <= 1500, cast == 43) %>% ungroup() %>%
  mutate(variable = fct_relevel(variable, levels = c("temperature", "salinity", "sigmaT", "fluorescence", "oxygen", "beamAttenuation"))) %>%
  ggplot(aes(x = value, y = depth)) +
  facet_wrap(~variable, scales = "free", strip.position = "bottom",
             labeller = as_labeller(c(temperature = "Temperature (\u00B0C)", salinity = "Salinity (ppt)", sigmaT = "Density (\u03C3\u03b8)", fluorescence = "Flurescence (rfu)",
                                      oxygen = "oxygen (mg/L)", beamAttenuation = "Beam Attenuation \n (relative)"))) +
  scale_y_reverse() + geom_path() + xlab(NULL) + theme_cowplot() + theme(strip.background = element_blank(), strip.placement = "outside")

ggsave("figures/CTDSummary.svg")
```

Cryptic warning mesage that seems to come from the fct_relevel, but that doenst have an effect